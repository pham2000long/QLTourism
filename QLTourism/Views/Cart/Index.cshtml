@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    int i = 0;
}
<script src="~/Assets/js/jquery-2.2.4.min.js"></script>

<div class="hero_in cart_section">
    <div class="wrapper">
        <div class="container">
            <div class="bs-wizard clearfix">
                <div class="bs-wizard-step active">
                    <div class="text-center bs-wizard-stepnum">Giỏi hàng</div>
                    <div class="progress">
                        <div class="progress-bar"></div>
                    </div>
                    <a href="#0" class="bs-wizard-dot"></a>
                </div>

                <div class="bs-wizard-step disabled">
                    <div class="text-center bs-wizard-stepnum">Thanh toán</div>
                    <div class="progress">
                        <div class="progress-bar"></div>
                    </div>
                    <a href="#0" class="bs-wizard-dot"></a>
                </div>

                <div class="bs-wizard-step disabled">
                    <div class="text-center bs-wizard-stepnum">Hoàn thành!</div>
                    <div class="progress">
                        <div class="progress-bar"></div>
                    </div>
                    <a href="#0" class="bs-wizard-dot"></a>
                </div>
            </div>
            <!-- End bs-wizard -->
        </div>
    </div>
</div>
<!--/hero_in-->

<div class="bg_color_1">
    <div class="container margin_60_35" style="transform: none; max-width: 1700px">
        <div class="row">
            <div class="col-lg-8">
                <div class="box_cart">
                    <table class="table table-striped cart-list">
                        <thead>
                            <tr>
                                <th>
                                    Tour
                                </th>
                                <th>
                                    Loại combo
                                </th>
                                <th>
                                    Số gói
                                </th>
                                <th>
                                    Huỷ
                                </th>

                            </tr>
                        </thead>
                        <tbody>
                            @if (Session["CartItem"] != null)
                            {
                                foreach (var item in ViewBag.pkg)
                                {
                                    int a = 0, b = 0;
                                    foreach (string[] itemz in ViewBag.dsSession)
                                    {
                                        if (Int32.Parse(itemz[2]) == item.id)
                                        {
                                            a = Int32.Parse(itemz[0]);
                                            b = Int32.Parse(itemz[1]);
                                        }
                                    }
                                    <tr>
                                        <td>
                                            <div class="thumb_cart">
                                                @if (item.thumbail != null)
                                                {
                                                    string ImagePath = "~/Areas/Admin/wwwroot/thumbail/" + item.thumbail;
                                                    <img src="@Url.Content(ImagePath)" alt="Image" style="width:60px;height:60px;object-fit:cover;">
                                                }

                                            </div>
                                            <span class="item_cart">@item.pkgName</span>
                                        </td>
                                        <td style="width:25%; !important">
                                            <select name="combo" id="loaicombo@(i)" class="form-control">
                                                @foreach (var itemCombo in item.Prices)
                                                {
                                                <option value="@itemCombo.id" @(itemCombo.id == a ? "selected" : "" )>@itemCombo.title - @String.Format("{0:n0}", itemCombo.price1)</option>
                                                }
                                            </select>
                                        </td>
                                        <td style="width:15%; !important">
                                            <input type="number" min="1" step="1" name="numberBuy" id="sogoi@(i)" class="form-control" value="@b" placeholder="">
                                        </td>
                                        <td class="options" style="width:5%; text-align:center;">
                                            <a href="/cart/Delete/@item.id"><i class="icon-trash"></i></a>
                                        </td>
                                    </tr>
                                    i++;
                                }

                            }
                        </tbody>
                    </table>
                    <div class="cart-options clearfix">
                        <div class="float-left">
                        </div>
                        <div class="float-right fix_mobile">
                            <button type="button" class="btn_1 outline" id="@if (Session["CartItem"] != null) {@Html.Raw("updateCart")}">Cập nhật giỏ hàng</button>
                        </div>
                    </div>
                    <!-- /cart-options -->
                </div>
            </div>
            <!-- /col -->

            <aside class="col-lg-4" id="sidebar">
                <div class="box_detail">
                    <div id="total_cart">
                        Tổng tiền: <span class="float-right" id="sumPrice">@String.Format("{0:n0}", @ViewBag.totalprice) VNĐ</span>
                    </div>
                    <ul class="cart_details">
                        <li>Tổng gói: <span id="sumCombo">@ViewBag.total</span></li>
                    </ul>
                    <a href="cart-2.html" class="btn_1 full-width purchase">Kiểm tra</a>
                    <div class="text-center"><small>Tại bước này thì bạn chưa mất tiền!</small></div>
                </div>
            </aside>
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /bg_color_1 -->

<script src="~/Assets/js/jquery-2.2.4.min.js"></script>
<script>
    $(document).ready(function () {
        $('#updateCart').click(function () {
            var num = "";
            num = num @{
                if (ViewBag.dsSession != null)
                {
                    int iz = 0;
                    foreach(var item in ViewBag.dsSession)
                    {
                       @Html.Raw("+$('#loaicombo" + iz.ToString() + "').find(':selected').val() + '|' + $('#sogoi" + iz.ToString() + "').val() + '|' + '" + item[2] + "'+'&'"); iz++;
                    } @Html.Raw(";")
                }

            }
            num = num.substring(0, num.length - 1);
            var data = {
                "ses": num
            };
            $.ajax({
                url: "/Cart/updateCart",
                type: "POST",
                data: JSON.stringify(data),
                dataType: "json",
                contentType: "application/json",
                success: function (response) {
                    let number = response.totalpricez;
                    $("#sumPrice").html(number.toLocaleString() + " VNĐ");
                    $("#sumCombo").html(response.totalz);
                },
                error: function () {

                }
            });
        });
    });
</script>
